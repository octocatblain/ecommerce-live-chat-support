var chatDiv,guestChatInt,checkNewMsgInt,pendingUploadsTimer,fullscreen,inline,tokenID=0,newIndex=0,lastMsg={},nowTime=new Date,toggleStats=0,disabledBox=[],response=!0,lastNewMsg=0,smilesWin=!1,callBackID=0,uploads={},pendingUploadsInt=!1,linkifySys=!0,remBeforeSet="",isMobile=!1,chatClosed=!1,iframebottom="-354px";function generateMsg(e,a,t){var n={};return e.msg=emoticons(t?htmlspecialchars(e.msg).linkify():e.msg.linkify(),emoticonsData),n=void 0!==users[e.user]?users[e.user]:{name:unknownTxt,avatarLink:defaultAvatar},void 0===a&&(a=!1),(!0===a?subTemplate:template).replace(/{{messageId}}/g,"msg_"+e.id).replace(/{{contentId}}/g,"con_"+e.id).replace(/{{nowTime}}/g,e.nowTime).replace(/{{message}}/g,e.msg).replace(/{{msgAdd}}/g,"").replace(/{{userName}}/g,n.name).replace(/{{avatarLink}}/g,n.avatarLink)}function loadChat(){chatOpen||($(".chatCloseBtn > span").removeClass("glyphicons-chevron-down").addClass("glyphicons-chevron-up"),$(".chatSetBtn").addClass("hide")),"login"!==activePage&&"contact"!==activePage?($("#chat-history").html($("#default-messages").html()),$.get(axPath+"/load-messages-html",function(e){e.success&&(callBackID=e.callBackID,$(chatDiv).append(e.chatHTML),lastMsg=e.lastMsg,$.extend(users,e.users),tokenID=e.token,timeago.cancel(),timeago().render($(".caltime"))),startChat()})):startChat()}function guestChat(){0===chatID&&$.get(axPath+"/guest",function(e){e.success&&(clearInterval(guestChatInt),guestChatInt=!1,chatID=e.chatID,userID=e.userID,$("#uname").val(e.name),$("#uemail").val(e.email),"no-email@guest.com"!==e.email&&$("#uemail").attr("disabled","disabled"),users["user"+userID]={id:userID,name:e.name,avatarLink:e.avatarLink},$("#chat-history").html($("#default-messages").html()),$(".input-group-right").hasClass("inDisabled")&&($("#chatTxt").prop("disabled",!1),$(".input-group-right").removeClass("inDisabled"),chatClosed=!1),$("#updateUserBtn").removeClass("disabled"),$("#closeChatBtn").removeClass("disabled"),$("#printChat").removeClass("disabled"),activatePage("chat"))})}function pendingUploads(){var e=JSON.stringify(Object.keys(uploads));$.post(axPath+"/upload/pending",{data:e},function(e){e.success&&(e.pendingUploads||(sendToHome({action:"uploads",pending:!1}),pendingUploadsInt=!1,clearInterval(pendingUploadsTimer)),$.each(e.upload,function(e,a){a.stats?($("#uploadRes"+e).html('<span class="uploading"><span class="icon-upload2"></span> '+uploadingTxt+' <img class="loader" src="'+previewImgLoader+'" /></span>'),uploads[e].doUpload(e,a.uploadAuth)):$("#uploadRes"+e).html('<span class="upFail"> <span class="icon-cross"></span> '+a.error+"</span>"),delete uploads[e]}))})}function checkNewMsg(){response&&(response=!1,$.get(axPath+"/check/new-messages/"+callBackID,function(e){if(response=!0,e.newMessages){callBackID=e.callBackID;var a=e.chatHTML;$.extend(users,e.users);for(var t=0;t<a.length;++t)"1"===a[t].notify?notifyMsg(a[t].msg,!1):(a[t].upload&&(linkifySys=!1),addMsg(a[t].msg,a[t].user_id,a[t].staff_id,!1,a[t].date,!1),playTone())}0===e.chatStatus&&endChat(!0)}))}function chatRate(e,a){$(".chatRate > .chatAct").removeClass("chatAct"),$(e).addClass("chatAct"),$("#chat-history .chatRateMsg").css({visibility:"visible"}),$.get(axPath+"/rating/"+chatID+"/"+a,function(e){})}function endChat(e){chatClosed=!0,$("#chatTxt").prop("disabled",!0),$(".input-group-right").addClass("inDisabled"),$("#chat-history").append($("#chatRateBox").html()+"<br>"),$("#updateUserBtn").addClass("disabled"),$("#closeChatBtn").addClass("disabled"),$("#printChat").addClass("disabled"),e?$.get(axPath+"/close/0",function(e){}):(notifyMsg(endTxt,!0),$.get(axPath+"/close/1",function(e){})),clearInterval(checkNewMsgInt),checkNewMsgInt=!1}function userEndChat(e){1===e?(endChat(!1),$(".chatSetBtn").removeClass("chatSetBtnAactive"),$(".triangle").css("display","none"),activatePage("chat"),$("#endChat").hide(),$("#options").show(),$(chatDiv).animate({scrollTop:chatDiv.scrollHeight},"fast")):0===e?($("#endChat").hide(),$("#options").fadeIn()):($("#options").hide(),$("#endChat").removeClass("hide").fadeIn())}function sendTranscript(){$("#transcriptBtn").addClass("disabled"),$("#transcriptIcon").removeClass("glyphicons-envelope").addClass("glyphicons-repeat spin"),$.get(axPath+"/transcript/"+chatID,function(e){e.success?notifyMsg(transSus,!1):(notifyMsg(transFail,!1),$("#transcriptBtn").removeClass("disabled")),$("#transcriptIcon").removeClass("glyphicons-repeat spin").addClass("glyphicons-envelope")})}function showSmiles(){chatClosed||(smilesWin?hideSmiles():(smilesWin=!0,$("#chat-smiles").fadeIn()))}function selSmile(e){$("#chatTxt").val($("#chatTxt").val()+" "+e+" ");var a=$("#chatTxt").get(0),t=a.value.length;a.selectionStart=t,a.selectionEnd=t,a.focus(),hideSmiles(!0)}function hideSmiles(e){smilesWin=!1,void 0===e&&(e=!1),e?$("#chat-smiles").hide():$("#chat-smiles").fadeOut()}function startChat(){activatePage(activePage),sendToHome({action:"css",arr:["display:block"]}),1===chatOpen&&toggleChat()}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function emoticons(e,a){var t;return t=a,Object.keys(t).reduce(function(e,a){var n=new RegExp(escapeRegExp(a),"g"),s=String(t[a][1]).replace(/\$/g,"$$$$");return e.replace(n,s)},e)}function playTone(){tone&&(1==$("#tone").val()&&myTone.play())}function muteSound(){1==$("#tone").val()?($("#tone").val(0),$("#toneK").removeClass("glyphicons-volume-up"),$("#toneK").addClass("glyphicons-volume-down"),$("#toneTxt").css("text-decoration","line-through")):($("#tone").val(1),$("#toneK").addClass("glyphicons-volume-up"),$("#toneK").removeClass("glyphicons-volume-down"),$("#toneTxt").css("text-decoration","none"))}function analyticsUpdate(){$.get(analyticsUpdateLink,function(e){})}function contactFn(e){var a=!0,t=$("#cname").val().trim(),n=$("#cemail").val().trim(),s=$("#cmsg").val();""===t&&($("#cname-err").fadeIn(),$("#cname").addClass("login-err"),a=!1),""===n?($("#cemail-err").fadeIn(),$("#cemail").addClass("login-err"),a=!1):validateEmail(n)||($("#cemail-err").fadeIn(),$("#cemail").addClass("login-err"),a=!1),""===s&&($("#cmsg-err").fadeIn(),$("#cmsg").addClass("login-err"),a=!1),a&&$("#contactStep2").length>0&&e&&(a=!1,$("#contactStep1").css("display","none"),$("#contactStep2").css("display","block")),a&&validateCaptcha("contact",{name:t,email:n,msg:s})}function startTask(e,a,t){"contact"===e&&($(".cLoad").show(),$("#contactStep2").css("display","none"),$("#contactStep3").css("display","block"),$.post(frAxPath+"/contact",{json:"1",name:a.name,email:a.email,msg:a.msg,skey:t},function(e){$(".cLoad").hide(),e.success?$(".cSuccess").removeClass("hide"):$(".cFailed").removeClass("hide")}))}function captchaCodeCheck(){if($(".captchaCode").length>0){var e=$("#capType").val();if("phpcap"==e){if(""==$("input[name=scode]").val())return!0}else if("recap"==e&&""==grecaptcha.getResponse())return!0}return!1}function captchaCodeCheckMsg(){return!captchaCodeCheck()||(alert(imageVr),!1)}function validateCaptcha(e,a){if($(".captchaCode").length>0){var t,n,s;if(captchaCodeCheck())return alert(imageVr),!1;n={capthca:"1"},capType=$("#capType").val(),"phpcap"==capType?(t=$("input[name=scode]").val(),n.scode=t,n.pageUID=$("input[name=pageUID]").val()):"recap"==capType&&(t=grecaptcha.getResponse(),n["g-recaptcha-response"]=t),$.post(frAxPath+"/verification/get-auth",n,function(t){if("1"!=(s=t.split(":::"))[0])return alert(capCodeWrg),"phpcap"==capType&&reloadCap(),!1;startTask(e,a,s[1])})}else s=$("#authCode").length>0?$("#authCode").val():0,startTask(e,a,s)}function reloadCap(){$('input[name="scode"]').val(""),$('input[name="scode"]').attr("placeholder",capRefresh),$('input[name="scode"]').prop("disabled",!0),$("#capImg").css("opacity","0.5"),$.get(baseUrl+"phpcap/reload",function(e){var a=$.trim(e).split(":::");$("#pageUID").val(a[1]),$("#capImg").attr("src",a[0]),$('input[name="scode"]').attr("placeholder",""),$('input[name="scode"]').prop("disabled",!1),$("#capImg").css("opacity","1")})}function lockBtn(e){if(e.constructor===Array)for(i=0;i<e.length;++i)$("#"+e[i]).attr("disabled",""),disabledBox.push(e[i]);else $("#"+e).attr("disabled",""),disabledBox.push(e)}function unlockBtn(e){if(e.constructor===Array)for(i=0;i<e.length;++i)$("#"+e[i]).removeAttr("disabled",""),disabledBox.pull(e[i]);else $("#"+e).removeAttr("disabled",""),disabledBox.pull(e)}function htmlentities(e){return e.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})}function htmlspecialchars(e){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"'"};return e.replace(/[&<>"']/g,function(e){return a[e]})}function formatBytes(e,a){if(0==e)return"0 Bytes";var t=a<=0?0:a||2,n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}function inc(){return tokenID++}function listen(e,a,t){return e.addEventListener?(e.addEventListener(a,t,!1),!0):!!e.attachEvent&&e.attachEvent("on"+a,t)}function sendToHome(e){window.parent.postMessage(e,"*")}function recFromHome(e){void 0!==e.data.action&&("scroll"===e.data.action?chatDiv.scrollTop=chatDiv.scrollHeight:"iframebottom"===e.data.action?iframebottom=e.data.val:"analytics"===e.data.action?$.post(trackLink,e.data.val,function(e){}):"inline"===e.data.action?(inline=!0,$("#rainbow-chat").css("border-radius","0"),$("#rainbow-chat header").css({"border-radius":"0",cursor:"default"}),$("#rainbow-chat .chat-smiles").css({width:"98%",height:"auto"}),$(".chatCloseBtn").hide(),$("#fullScreenBtn").hide(),$("#separateBtn").hide(),$("#chatOptBtn").removeClass("chatSetBtn").addClass("chatMinBtn"),$(".triangle").css("right","20px")):"desktop"===e.data.action?(isMobile=!1,$("#rainbow-mobile-chat").addClass("hide"),$("#rainbow-chat").removeClass("hide").fadeIn()):"mobile"===e.data.action&&(isMobile=!0,1===toggleStats?mobileLayout():($("#rainbow-chat").addClass("hide"),$("#rainbow-mobile-chat").removeClass("hide").fadeIn())))}function updateUserAvatar(e){var a=document.getElementById("userAvatar"),t=new Image;t.onload=function(){a.src=this.src},t.src=e}function activatePage(e){activePage=e,$("#pageTitle").html(pageTitle),$(".login-page").hide(),$(".chat-page").hide(),$(".contact-page").hide(),$(".settings-page").hide(),"login"===e?($(".login-page").fadeIn().show(),guestChatInt||(chatID=0,guestChatInt=setInterval(guestChat,chatRefreshTime))):"chat"===e?($(".chat-page").fadeIn().show(),checkNewMsgInt||chatClosed||(checkNewMsgInt=setInterval(checkNewMsg,chatRefreshTime))):"contact"===e?$(".contact-page").fadeIn().show():"settings"===e&&$(".settings-page").fadeIn().show()}function validateEmail(e){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(String(e).toLowerCase())}function cssAnimate(e,a){for(var t=a,n=[],s=0;s<t.length;s++){var o=t[s].split(":");n[o[0]]=o[1]}$(e).animate(n,{duration:400,queue:!1})}function toggleChat(){fullscreen||inline||(0===toggleStats?($(".chatCloseBtn > span").removeClass("glyphicons-chevron-up").addClass("glyphicons-chevron-down"),$(".chatSetBtn").removeClass("hide"),toggleStats=1,sendToHome({action:"animate",arr:["bottom:0"],scroll:"1"}),chatDiv.scrollTop=chatDiv.scrollHeight):1===toggleStats&&(toggleStats=0,$(".chatSetBtn").addClass("hide"),$(".chatCloseBtn > span").removeClass("glyphicons-chevron-down").addClass("glyphicons-chevron-up"),sendToHome({action:"animate",arr:["bottom:"+iframebottom]}),"settings"===activePage&&(activatePage(remBeforeSet),$(".chatSetBtn").removeClass("chatSetBtnAactive"),$(".triangle").css("display","none"))),setRam("chatOpen",toggleStats))}function chatResize(){var e=$(window).height();e-=100,$("#chat-history").css("height",e+"px")}function fullScreen(){sendToHome({action:"fullscreen"}),fullscreen?(fullscreen=!1,$("#rainbow-chat").css("border-radius","8px 8px 0 0"),$("#rainbow-chat header").css("border-radius","5px 5px 0 0"),$("#rainbow-chat .chat-smiles").css({width:"315px",height:"68px"}),$(".chatCloseBtn").show(),$("#chatMinBtn").css("display","none")):(fullscreen=!0,$("#rainbow-chat").css("border-radius","0"),$("#rainbow-chat header").css("border-radius","0"),$("#rainbow-chat .chat-smiles").css({width:"98%",height:"auto"}),$(".chatCloseBtn").hide(),$("#chatMinBtn").css("display","block"))}function mobileLayout(){sendToHome({action:"fullscreen"}),fullscreen=!0,$("#rainbow-chat").css("border-radius","0"),$("#rainbow-chat header").css("border-radius","0"),$("#rainbow-chat .chat-smiles").css({width:"98%",height:"auto"}),$(".chatCloseBtn").hide(),$("#chatMobileBtn").css("display","block"),$("#fullScreenBtn").fadeOut()}function updateUserInfo(e){if(0===e)$("#updateDetails").hide(),$("#options").fadeIn();else if(1===e){var a=$("#uname").val().trim(),t=$("#uemail").val().trim(),n=!0;""===a&&($("#uname-err").fadeIn(),$("#uname").addClass("login-err"),n=!1),""===t?($("#uemail-err").fadeIn(),$("#uemail").addClass("login-err"),n=!1):validateEmail(t)||($("#uemail-err").fadeIn(),$("#uemail").addClass("login-err"),n=!1),n&&$.post(axPath+"/update-user",{name:a,email:t},function(e){e.success?(users["user"+userID].name=a,$("#updateDetails").hide(),$("#options").fadeIn()):alert(someErrTxt)})}else $("#options").hide(),$("#updateDetails").removeClass("hide").fadeIn()}function addLastMsg(e,a,t){lastMsg={id:e,msgid:"msg_"+e,conid:"con_"+e,user:a,time:t}}$(document).ready(function(){(chatDiv=document.getElementById("chat-history"),$.ajaxSetup({timeout:2e4,error:function(e){unlockBtn(disabledBox),"timeout"===e.statusText?console.log("Connection Timeout: Please check your internet connection and try again!"):"error"===e.statusText&&console.log("Network Error!")}}),listen(window,"message",recFromHome),listen(window,"resize",chatResize),setInterval(analyticsUpdate,analyticsUpdateTime),timeago.register("en",locale),timeago().render($(".caltime")),sendToHome({action:"iframebottom"}),null!==getRam("chatOpen")&&(chatOpen=parseInt(getRam("chatOpen"))),loadChat(),tone)&&(document.getElementById("myTone").src=tonePath);function e(e,a,t,n,s){var o="";return"audio"===n?o="uploadAudio":"video"===n?o="uploadVideo":"image"===n?o="uploadImg":"zip"===n&&(o="uploadZip"),'<div class="uploadBox '+o+'" id="upload'+e+'">\n    <div class="upInfo">File: '+a+'</div>\n    <div class="upInfo">Size: '+(t=formatBytes(t))+'</div>\n    <hr>\n    <div class="uploadBoxRes" id="uploadRes'+e+'">\n      <span class="uploading"><span class="icon-upload2"></span> '+s+' <img class="loader" src="'+previewImgLoader+'" /></span>\n    </div>\n    </div>'}$("#rainbow-mobile-chat").click(function(e){$("#rainbow-mobile-chat").addClass("hide"),$("#rainbow-chat").removeClass("hide"),toggleChat(),mobileLayout()}),$("#chatMobileBtn").click(function(e){fullscreen=!1,sendToHome({action:"fullscreen"}),$("#rainbow-chat").css("border-radius","8px 8px 0 0").addClass("hide"),$("#rainbow-chat header").css("border-radius","5px 5px 0 0"),$("#rainbow-chat .chat-smiles").css({width:"315px",height:"68px"}),$(".chatCloseBtn").show(),$("#chatMobileBtn").css("display","none"),$("#rainbow-mobile-chat").removeClass("hide"),sendToHome({action:"resize"})}),$(".chatSetBtn").click(function(e){e.stopImmediatePropagation(),"settings"!==activePage?(remBeforeSet=activePage,activatePage("settings"),$(".chatSetBtn").addClass("chatSetBtnAactive"),$(".triangle").css("display","inline")):(activatePage(remBeforeSet),$(".chatSetBtn").removeClass("chatSetBtnAactive"),$(".triangle").css("display","none"))}),$("#chatMinBtn").click(function(e){e.stopImmediatePropagation(),fullScreen()}),$("#chatLogin").submit(function(e){e.preventDefault();var a=!0,t=$("#lname").val().trim(),n=$("#lemail").val().trim(),s=$("#lhelp option:selected").val();""===t&&($("#lname-err").fadeIn(),$("#lname").addClass("login-err"),a=!1),""===n?($("#lemail-err").fadeIn(),$("#lemail").addClass("login-err"),a=!1):validateEmail(n)||($("#lemail-err").fadeIn(),$("#lemail").addClass("login-err"),a=!1),"0"===s&&($("#lhelp-err").fadeIn(),$("#lhelp").addClass("login-err"),a=!1),a&&(lockBtn("loginBtn"),$.post(axPath+"/new",{json:"1",name:t,email:n,help:s,image:availableAvatars[arrowCount].id},function(e){unlockBtn("loginBtn"),void 0!==e.success?(clearInterval(guestChatInt),guestChatInt=!1,chatID=e.chatID,userID=e.userID,$("#uname").val(t),$("#uemail").val(n),$("#uemail").attr("disabled","disabled"),users["user"+userID]={id:userID,name:t,avatarLink:availableAvatars[arrowCount].path},$("#chat-history").html($("#default-messages").html()),$(".input-group-right").hasClass("inDisabled")&&($("#chatTxt").prop("disabled",!1),$(".input-group-right").removeClass("inDisabled"),chatClosed=!1),$("#updateUserBtn").removeClass("disabled"),$("#closeChatBtn").removeClass("disabled"),$("#printChat").removeClass("disabled"),activatePage("chat")):alert(e.error)}))}),$("#avatarLeft").click(function(){arrowCount--,-1===arrowCount&&(arrowCount=availableAvatars.length-1),void 0===availableAvatars[arrowCount]&&(arrowCount=0),updateUserAvatar(availableAvatars[arrowCount].path)}),$("#avatarRight").click(function(){arrowCount++,arrowCount===availableAvatars.length&&(arrowCount=0),void 0===availableAvatars[arrowCount]&&(arrowCount=0),updateUserAvatar(availableAvatars[arrowCount].path)}),$("#lhelp").change(function(){$("#lhelp").addClass("select-txt")}),$("#lhelp").focus(function(){$("#lhelp-err").fadeOut(),$("#lhelp").removeClass("login-err")}),$("#lname").focus(function(){$("#lname-err").fadeOut(),$("#lname").removeClass("login-err")}),$("#lemail").focus(function(){$("#lemail-err").fadeOut(),$("#lemail").removeClass("login-err")}),$("#uname").focus(function(){$("#uname-err").fadeOut(),$("#uname").removeClass("login-err")}),$("#uemail").focus(function(){$("#uemail-err").fadeOut(),$("#uemail").removeClass("login-err")}),$("#chaForm").submit(function(e){e.preventDefault();var a=$("#chatTxt").val().trim();""!==a&&($("#chatTxt").val(""),addMsg(a,userID,"-1",!0))}),$("#chatTxt").focus(function(){$(".input-group").addClass("focused")}).blur(function(){$(".input-group").removeClass("focused")}),$("#rainbow-chat header").on("click",function(){toggleChat()}),$("#chatTxt").click(function(e){hideSmiles()}),$("#chat-history").click(function(e){hideSmiles()}),$("#send-file-btn").click(function(){chatClosed||$("#send-file").click()}),$("#send-file").on("change",function(a){var t=$(this)[0].files[0],n=new Upload(t),s=!1;s=void 0!==lastMsg.user&&lastMsg.user==="user"+userID,$.post(axPath+"/upload/new",{name:n.getName(),size:n.getSize(),subMsg:s},function(a){a.success?(linkifySys=!1,a.upload?(addMsg(e(a.uploadID,n.getName(),n.getSize(),a.type,uploadingTxt),userID,-1,!1,void 0,!1),playTone(),n.doUpload(a.uploadID,a.uploadAuth,t)):(addMsg(e(a.uploadID,n.getName(),n.getSize(),a.type,waitApTxt),userID,-1,!1,void 0,!1),playTone(),uploads[a.uploadID]=n,pendingUploadsInt||(sendToHome({action:"uploads",pending:!0}),pendingUploadsInt=!0,pendingUploadsTimer=setInterval(pendingUploads,chatRefreshTime)))):alert(a.error)})}),$("#printChat").on("click",function(e){window.open(axPath+"/print-chat","Title","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=600,top="+(screen.height-400)+",left="+(screen.width-840))}),$("#cmsg").focus(function(){$("#cmsg-err").fadeOut(),$("#cmsg").removeClass("login-err")}),$("#cname").focus(function(){$("#cname-err").fadeOut(),$("#cname").removeClass("login-err")}),$("#cemail").focus(function(){$("#cemail-err").fadeOut(),$("#cemail").removeClass("login-err")}),$("#tryContactBtn").on("click",function(e){$(".cSuccess").addClass("hide"),$(".cFailed").addClass("hide"),$("#contactStep3").css("display","none"),$("#contactStep1").css("display","block")})});var Upload=function(e){this.file=e};function notifyMsg(e,a){var t;void 0===a&&(a=!0);var n=$('<div class="notify">'+e+"....</div>").hide();$(chatDiv).append(n),n.fadeIn(),$(chatDiv).animate({scrollTop:chatDiv.scrollHeight},"fast"),lastMsg={},a&&(t={json:"1",msg:e,chatID:chatID},$.post(axPath+"/add-notify-msg",t,function(e){}))}function addMsg(e,a,t,n,s,o){var i,r,l,c,d,u;(nowTime=new Date,void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===s&&(s=nowTime),-1===a?(u=t,d="staff"+t):(u=a,d="user"+a),0===(newIndex=void 0===lastMsg.user?0:lastMsg.user!==d?0:1))?(newIndex=1,l=chatID+"_"+inc(),c={json:"1",msg:e,chatID:chatID},addLastMsg(l,d,s),i=generateMsg({id:l,nowTime:s,msg:e,userId:u,user:d},!1,o),r=chatDiv):(c={json:"1",msg:e,chatID:chatID,subMsg:!0},Date.parse(s)-Date.parse(lastMsg.time)>6e4?(l=chatID+"_"+inc(),r=document.getElementById(lastMsg.conid),addLastMsg(l,d,s),i=generateMsg({id:l,nowTime:s,msg:e,userId:u,user:d},!0,o)):(lastMsg.time=s,i=o?"<div>"+emoticons(htmlspecialchars(e).linkify(),emoticonsData)+"</div>":"<div>"+emoticons(e.linkify(),emoticonsData)+"</div>",r=document.getElementById(lastMsg.msgid)));var p=$(i).hide();$(r).append(p),p.fadeIn(),$(chatDiv).animate({scrollTop:chatDiv.scrollHeight},"fast"),timeago.cancel(),timeago().render($(".caltime")),n&&$.post(axPath+"/add",c,function(e){})}function setRam(e,a){return"undefined"!=typeof Storage?(localStorage.setItem(e,a),!0):(console.log("No Web Storage support.."),!1)}function getRam(e){return"undefined"!=typeof Storage?localStorage.getItem(e):(console.log("No Web Storage support.."),null)}function setCookie(e,a,t){var n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3);var s="expires="+n.toUTCString();document.cookie=e+"="+a+";"+s+";path=/"}function getCookie(e){for(var a=e+"=",t=decodeURIComponent(document.cookie).split(";"),n=0;n<t.length;n++){for(var s=t[n];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(a))return s.substring(a.length,s.length)}return""}Upload.prototype.getType=function(){return this.file.type},Upload.prototype.getSize=function(){return this.file.size},Upload.prototype.getName=function(){return this.file.name},Upload.prototype.doUpload=function(e,a){var t=this,n=new FormData;n.append("file",this.file,this.getName()),n.append("upload_file",!0),$.ajax({type:"POST",url:axPath+"/upload/process/"+e+"/"+a,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",t.progressHandling,!1),e},success:function(a){a.success&&(a.upload?$("#uploadRes"+e).html('<a class="uploadBoxHref" target="_blank" href="'+axPath+"/upload/view/"+e+'"><span class="icon-download2"></span> '+downloadTxt+"</a>"):$("#uploadRes"+e).html('<span class="upFail"> <span class="icon-cross"></span> '+a.error+"</span>"))},error:function(a){$("#uploadRes"+e).html('<span class="upFail"> <span class="icon-cross"></span> '+upErrTxt+"</span>")},async:!0,data:n,cache:!1,contentType:!1,processData:!1,timeout:6e4})},Upload.prototype.progressHandling=function(e){var a=0,t=e.loaded||e.position,n=e.total;e.lengthComputable&&(a=Math.ceil(t/n*100)),$("#progress-wrp .progress-bar").css("width",+a+"%"),$("#progress-wrp .status").text(a+"%")},Array.prototype.pull=function(e){for(var a=0;a<this.length;a++)this[a]===e&&(this.splice(a,1),a--);return this},String.linkify||(String.prototype.linkify=function(){if(!linkifySys)return linkifySys=!0,this;return this.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,function(e){switch(e.substr(e.lastIndexOf(".")+1)){case"jpg":case"png":case"jpeg":case"gif":case"bmp":var a="pre"+(new Date).getTime().toString()+Math.floor(1e3*Math.random()+1).toString(),t=$("<img />").attr("src",e).on("load error",function(e){"error"===e.type?(t.attr("alt",errLoadTxt),$("#"+a).html('<i style="color: #e74c3c;" class="fa fa-exclamation-triangle"></i>')):this.complete&&void 0!==this.naturalWidth&&0!=this.naturalWidth?(t.attr("class","previewImg"),t.attr("alt","Preview"),$("#"+a).html(t)):(t.attr("alt",errLoadTxt),$("#"+a).html('<i style="color: #e74c3c;" class="fa fa-exclamation-triangle"></i>'))});return'<a target="_blank" href="'+e+'"><div> <div id="'+a+'" class="previewBox"><img class="previewImg" src="'+previewImgLoader+'" alt="'+loadTxt+'"></div> </div> '+e+"</a> ";default:return'<a target="_blank" href="'+e+'">'+e+"</a>"}}).replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a target="_blank" href="http://$2">$2</a>').replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/gim,'<a target="_blank" href="mailto:$&">$&</a>')}),function(e,a){"object"==typeof module&&module.exports?(module.exports=a(),module.exports.default=module.exports):e.timeago=a()}("undefined"!=typeof window?window:this,function(){var e="second_minute_hour_day_week_month_year".split("_"),a={en:function(a,t){if(0===t)return["just now","right now"];var n=e[parseInt(t/2)];return a>1&&(n+="s"),[a+" "+n+" ago","in "+a+" "+n]}},t=[60,60,24,7,365/7/12,12],n=6,s="data-tid",o={};function i(e){return e instanceof Date?e:isNaN(e)?/^\d+$/.test(e)?new Date(r(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(e)):new Date(r(e))}function r(e){return parseInt(e)}function l(e,s,o){s=a[s]?s:a[o]?o:"en";for(var i=0,l=e<0?1:0,c=e=Math.abs(e);e>=t[i]&&i<n;i++)e/=t[i];return(e=r(e))>(0===(i*=2)?9:1)&&(i+=1),a[s](e,i,c)[l].replace("%s",e)}function c(e,a){return((a=a?i(a):new Date)-i(e))/1e3}function d(e,a){return e.getAttribute?e.getAttribute(a):e.attr?e.attr(a):void 0}function u(e,a){this.nowDate=e,this.defaultLocale=a||"en"}function p(e,a){return new u(e,a)}return u.prototype.doRender=function(e,a,i){var r,d=c(a,this.nowDate),u=this;e.innerHTML=l(d,i,this.defaultLocale),o[r=setTimeout(function(){u.doRender(e,a,i),delete o[r]},Math.min(1e3*function(e){for(var a=1,s=0,o=Math.abs(e);e>=t[s]&&s<n;s++)e/=t[s],a*=t[s];return o=(o%=a)?a-o:a,Math.ceil(o)}(d),2147483647))]=0,function(e,a){e.setAttribute?e.setAttribute(s,a):e.attr&&e.attr(s,a)}(e,r)},u.prototype.format=function(e,a){return l(c(e,this.nowDate),a,this.defaultLocale)},u.prototype.render=function(e,a){void 0===e.length&&(e=[e]);for(var t=0,n=e.length;t<n;t++)this.doRender(e[t],d(s=e[t],"data-timeago")||d(s,"datetime"),a);var s},u.prototype.setLocale=function(e){this.defaultLocale=e},p.register=function(e,t){a[e]=t},p.cancel=function(e){var a;if(e)(a=d(e,s))&&(clearTimeout(a),delete o[a]);else{for(a in o)clearTimeout(a);o={}}},p});