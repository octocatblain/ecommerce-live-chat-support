var detailsRefreshInt,chatTabs,tabs,response=!0,linkifySys=!0,activeChat="",chats={},chatUsers={},chatIDs={},inviteOpData={},detailsRefresh={},chatDiv="",popOverOptions={placement:function(a,e){return $(window).width()<751?"top":"right"},trigger:"hover"};function widthMe(){alert($(document).width())}function disabledDept(){return swal(oopsTxt,noDepTxt,"info"),!1}function loadMobilePage(a,e){$("#onlineDataBox").css("display","none"),$("#onlineDataOpBox").css("display","none"),$("#chatDataBox").css("display","none"),$("#userDetails").css("display","none"),$("#userPages").css("display","none"),$("#scroll-nav > .active").removeClass("active"),"chat"===a?($("#chatDataBox").css("display","block"),$(e).parent().addClass("active")):"users"===a?($("#onlineDataBox").css("display","block"),$(e).parent().addClass("active")):"details"===a?($("#userDetails").css("display","block"),$("#userPages").css("display","block"),$(e).parent().addClass("active")):"operators"===a&&($("#onlineDataOpBox").css("display","block"),$(e).parent().addClass("active"))}function htmlspecialchars(a){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"'"};return a.replace(/[&<>"']/g,function(a){return e[a]})}function escapeRegExp(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function inc(){return chats[activeChat].tokenID++}function playTone(a){tone&&1==$("#tone"+a).val()&&myTone.play()}function muteSound(a){1==$("#tone"+a).val()?($("#tone"+a).val(0),$("#toneK"+a).removeClass("fa-volume-up"),$("#toneK"+a).addClass("fa-volume-off ")):($("#tone"+a).val(1),$("#toneK"+a).addClass("fa-volume-up"),$("#toneK"+a).removeClass("fa-volume-off "))}function showSmiles(a){hideCannedMsg(a),chats[activeChat=a].smilesWin?hideSmiles(!1,a):(chats[activeChat].smilesWin=!0,$("#"+activeChat+" > .chat-page > .chat-smiles").fadeIn())}function selSmile(a,e){activeChat=e;var t=$("#"+activeChat+" > .chat-page > .chatForm > .input-group > .input-group-area > .chatTxt");$(t).val($(t).val()+" "+a+" ");a=$(t).get(0),t=a.value.length;a.selectionStart=t,a.selectionEnd=t,a.focus(),hideSmiles(!0,e)}function hideSmiles(a,e){activeChat=e;e=$("#"+activeChat+" > .chat-page > .chat-smiles");chats[activeChat].smilesWin=!1,void 0===a&&(a=!1),a?$(e).hide():$(e).fadeOut()}function refreshData(){response&&(response=!1,$.get(axPath+"/chats/refresh",function(s){var a;response=!0,s.success?($("#onlineCount").html("("+s.onlineUsersCount+")"),a=$("#onlineData > .ulscroll").scrollTop(),$("#onlineData").html(s.onlineData),$("#onlineData > .ulscroll").scrollTop(a),$("#adminCount").html("("+s.onlineAdminCount+")"),$("#adminData").html(s.adminData),$("#inviteData").html(s.inviteData),$('[data-toggle="popover"]').popover(popOverOptions),s.inviteChatBol&&Object.keys(s.inviteChat).forEach(function(a){(s.inviteChat[a].admin?genAdminChatWindow:genChatWindow)(s.inviteChat[a].userID,s.inviteChat[a].userName,s.inviteChat[a].chatID,!0,null,s.inviteChat[a].type,s.inviteChat[a].ownerID)}),s.updateChatHTML&&Object.keys(s.chatHTML).forEach(function(a){$("#userPages"+s.chatHTML[a].chatID+" .pagesBody").html(s.chatHTML[a].pagesData);var e=s.chatHTML[a].chatHTML;$.extend(users,s.chatHTML[a].users);for(var t=0;t<e.length;++t)"1"===e[t].notify?notifyMsg(e[t].msg,!1,a):(e[t].upload&&(linkifySys=!1),addMsg(e[t].msg,e[t].user_id,e[t].staff_id,!1,e[t].date,a,!1,!1),playTone(s.chatHTML[a].chatID));0===s.chatHTML[a].chatStatus&&($("#chat"+s.chatHTML[a].chatID+" .chat-page").append('<input type="hidden" class="closed" value="1" />'),$("#chat"+s.chatHTML[a].chatID+" .chatTxt").prop("disabled",!0),$("#chat"+s.chatHTML[a].chatID+" .input-group-right").addClass("inDisabled"),$("#chat"+s.chatHTML[a].chatID+" .chatTxtIcon").prop("onclick",null).off("click"),$("#chat"+s.chatHTML[a].chatID+" .send-file-btn").removeClass("send-file-btn"))})):swal(oopsTxt,errSomTxt,"info")}))}function notifyMsg(a,e,t){void 0===e&&(e=!0),activeChat=t,chatDiv=$("#"+activeChat+" > .chat-page > .chat-history");t=$('<div class="notify">'+a+"....</div>").hide();$(chatDiv).append(t),t.fadeIn(),$(chatDiv).animate({scrollTop:$(chatDiv)[0].scrollHeight},"fast"),chats[activeChat].lastMsg={},e&&(a={json:"1",msg:a,chatID:chatID},$.post(axPath+"/add-notify-msg",a,function(a){}))}function generateMsg(a,e,t){var s={};return a.msg=emoticons((t?htmlspecialchars(a.msg):a.msg).linkify(),emoticonsData),s=void 0!==users[a.user]?users[a.user]:{name:unknownTxt,avatarLink:defaultAvatar},void 0===e&&(e=!1),(!0===e?subTemplate:template).replace(/{{messageId}}/g,"msg_"+a.id).replace(/{{contentId}}/g,"con_"+a.id).replace(/{{nowTime}}/g,a.nowTime).replace(/{{message}}/g,a.msg).replace(/{{msgAdd}}/g,"").replace(/{{userName}}/g,s.name).replace(/{{avatarLink}}/g,s.avatarLink)}function emoticons(a,e){var s=e;return Object.keys(s).reduce(function(a,e){var t=new RegExp(escapeRegExp(e),"g"),e=String(s[e][1]).replace(/\$/g,"$$$$");return a.replace(t,e)},a)}function addLastMsg(a,e,t,s){void 0===s&&(s=activeChat),chats[s].lastMsg={id:a,msgid:"msg_"+a,conid:"con_"+a,user:e,time:t}}function addMsg(a,e,t,s,n,i,o,c){var l,r,d,h;nowTime=new Date,void 0===s&&(s=!0),void 0===o&&(o=!0),void 0===c&&(c=!0),void 0===n&&(n=nowTime),c&&(activeChat=i),c=i,chatDiv=$("#"+c+" > .chat-page > .chat-history"),e=-1===e?"staff"+(d=t):"user"+(d=e),newIndex=void 0===chats[c].lastMsg.user||chats[c].lastMsg.user!==e?0:1,0===newIndex?(newIndex=1,r=chats[c].chatID+"_"+inc(),h={json:"1",msg:a,chatID:chats[c].chatID},addLastMsg(r,e,n,i),u=generateMsg({id:r,nowTime:n,msg:a,userId:d,user:e},!1,o),l=chatDiv):(h={json:"1",msg:a,chatID:chats[c].chatID,subMsg:!0},6e4<Date.parse(n)-Date.parse(chats[c].lastMsg.time)?(r=chats[c].chatID+"_"+inc(),l=document.getElementById(chats[c].lastMsg.conid),addLastMsg(r,e,n,i),u=generateMsg({id:r,nowTime:n,msg:a,userId:d,user:e},!0,o)):(chats[c].lastMsg.time=n,u=o?"<div>"+emoticons(htmlspecialchars(a).linkify(),emoticonsData)+"</div>":"<div>"+emoticons(a.linkify(),emoticonsData)+"</div>",l=document.getElementById(chats[c].lastMsg.msgid)));var u=$(u).hide();$(l).append(u),u.fadeIn(),$(chatDiv).animate({scrollTop:$(chatDiv)[0].scrollHeight},"fast"),timeago.cancel(),timeago().render($(".caltime")),$(".tab-content").find("div.active").attr("id").substr(3)!=chats[c].chatID&&flashIt(chats[c].chatID,1),s&&$.post(axPath+"/add",h,function(a){})}function addChatHTML(a){a.success&&(void 0!==a.pagesData&&($("#userPages"+a.chatID).html(a.pagesData),$("#userPages"+a.chatID+" .userLoad").hide(),$("#userPages"+a.chatID+" #tableData").removeClass("hide")),$(chatDiv).append(a.chatHTML),chats[activeChat].lastMsg=a.lastMsg,$.extend(users,a.users),chats[activeChat].tokenID=a.token,timeago.cancel(),timeago().render($(".caltime")),$(chatDiv).animate({scrollTop:$(chatDiv)[0].scrollHeight},"fast"))}function waitGuestChat(a,e,t,s,n,i){swal(oopsTxt,alreadyCTxt,"info")}function selInviteStaff(a){var e=activeChat.substr(4);inviteOpData={staffID:a,chatID:e}}function inviteUser(){var a=document.createElement("div");a.innerHTML="<style>.swal-modal {width: 280px}.swal-content{text-align:left}.swal-button--confirm{background-color: #98D973}.swal-button--confirm:focus{box-shadow: 0 0 0 1px #fff, 0 0 0 3px rgba(152, 217, 115, 0.29)}</style>",a.innerHTML+=$("#inviteData").html(),swal({title:inOpTxt,content:a,buttons:["Cancel","Invite"]}).then(a=>{a?void 0!==inviteOpData.chatID?$.post(axPath+"/inviteStaff",inviteOpData,function(a){a.success?swal("Success!",inTxt,"success"):void 0===a.error?swal(oopsTxt,intTxt,"error"):swal(oopsTxt,a.error,"error"),inviteOpData={}}):swal(oopsTxt,selOpTxt,"error"):inviteOpData={}})}function guestChatWindow(e,a,t,s,n,i,o){swal({title:inUsTxt,text:areInUsTxt,buttons:[cancelTxt,inviteTxt],dangerMode:!0}).then(a=>{a&&$.get(axPath+"/invite/"+e+"/"+n,function(a){a.success?genChatWindow(a.userID,a.userName,a.chatID,!0,void 0,void 0,a.ownerID):swal(oopsTxt,unStartTxt,"error")})})}function joinChatWindow(e,t,s,n,i,a,o){swal({title:joinTxt,text:useChatTxt,buttons:[cancelTxt,joinTxt1],dangerMode:!0}).then(a=>{a&&genChatWindow(e,t,s,n,i,4,o)})}function processUserDetails(){$.post(axPath+"/userDetailsArr",{chats:detailsRefresh},function(s){s.success&&(s.remove&&clearInterval(detailsRefreshInt),Object.keys(s.userDetails).forEach(function(a){var e=s.userDetails[a],t=$("#masterUserDetails").html();t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/{{ip}}/g,e.ip)).replace(/{{username}}/g,e.name)).replace(/{{email}}/g,e.email)).replace(/{{location}}/g,e.location)).replace(/{{browser}}/g,e.browser)).replace(/{{platform}}/g,e.platform)).replace(/{{ua}}/g,e.ua)).replace(/{{screen}}/g,e.screen)).replace(/{{tabID}}/g,"tab"+a)).replace(/{{chatID}}/g,a),$("#userDetails"+a).html(t),$("#userDetails"+a+" .userLoad").hide(),$("#userDetails"+a+" .table").fadeIn(),$("#userDetails"+a+" .btnDis").prop("disabled",!1),$("#userDetails"+a+" .table").removeClass("hide"),delete detailsRefresh["chat"+a]}))})}function adminChatWindow(e,t,s,n,a,i,o){e!=adminID?0==s?$.get(axPath+"/createAdminChat/"+e,function(a){a.success&&(s=a.chatID,genAdminChatWindow(e,t,s,n,a,i,o))}):genAdminChatWindow(e,t,s,n,a,i,o):sweetAlert(oopsTxt,cantTxt,"error")}function cannedBox(a){1==$("#canned"+a).val()?($("#canned"+a).val(0),$("#cannedK"+a).removeClass("glyphicon-ok-sign"),$("#cannedK"+a).addClass("glyphicon-remove-sign")):($("#canned"+a).val(1),$("#cannedK"+a).addClass("glyphicon-ok-sign"),$("#cannedK"+a).removeClass("fa-remove-off "))}function hideCannedMsg(a){a=$("#"+a+" #cannedMsg");$(a).fadeOut()}function setCannedMsg(a,e){var t=$(e).find(".wordData"+a).html(),s=$(e).find(".word"+a).data("temp"),n=$(e).find(".word"+a).data("chat"),e=$("#chat"+n+" .chatTxt").val(),a=$("#chat"+n+" #cannedMsg"),e=e.replace(new RegExp(s+"$"),t);$("#chat"+n+" .chatTxt").val(e),$("#chat"+n+" .chatTxt").focus(),$(a).fadeOut()}function processCannedMsg(i,o,a,c,l,r){var d=1;0==a&&$(i).fadeOut(),Object.keys(c).forEach(function(a){var e,t,s,n,a=1===cannedMsgType?c[e=a]:(e=c[a].code,c[a].data);$(i).fadeIn(),$("#chat"+o+" .wordData"+d).html(a),e.match(l)&&(n=new RegExp(l,"gi"),s=e.replace(n,"<strong>"+l+"</strong>"),t=l),""!=r&&e.match(r+" "+l)&&(n=new RegExp(r+" "+l,"gi"),s=e.replace(n,"<strong>"+r+" "+l+"</strong>"),t=r+" "+l),$("#chat"+o+" .word"+d).data("temp",t),$("#chat"+o+" .word"+d).data("chat",o),$("#chat"+o+" .word"+d).html(s),d++})}function cannedMsg(a,e){var t,s,n=$("#chat"+e+" #cannedMsg"),i=a.split(" "),o=i[i.length-1],c=i[i.length-2],a=!0;""!=o&&2<o.length&&(a=!1,void 0===c&&(c=""),$("#chat"+e+" .word1").html(""),$("#chat"+e+" .word2").html(""),$("#chat"+e+" .word3").html(""),$("#chat"+e+" .wordData1").html(""),$("#chat"+e+" .wordData2").html(""),$("#chat"+e+" .wordData3").html(""),1===cannedMsgType?$.post(axPath+"/search-canned",{word:o,word2:c,chat_id:e},function(a){a.success&&processCannedMsg(n,e,a.count,a.canned,o,c,cannedMsgType)}):(t=new RegExp("^"+o,"i"),(i=$.grep(cannedMsgArr,function(a,e){return t.test(a.code)})).length<3&&(t=new RegExp("^"+c+" "+o,"i"),s=$.grep(cannedMsgArr,function(a,e){return t.test(a.code)})),s=i.concat(s),processCannedMsg(n,e,s.length,s,o,c,cannedMsgType))),a&&$(n).fadeOut()}function genAdminChatWindow(a,e,t,s,n,i,o){o=adminID;var c,l,r,d="staff"+a,h="chat"+t;flashIt(t,0),void 0===chatIDs[t]?(c=$("#masterAdminDetails").html(),$("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userDetails").append('<div id="userDetails'+t+'" class="nohide">'+c+"</div>"),chatIDs[t]="",r=(r=(r=$("#masterChatdata").html()).replace(/{{userID}}/g,h)).replace(/{{ownerID}}/g,o),tabs=$("#tabs").bootstrapDynamicTabs(),chats[activeChat=h]={smilesWin:!1,lastMsg:{},tokenID:0,chatID:t,disabledBox:[]},tabs.addTab({id:"tab"+t,title:'<span id="title'+t+'"><i class="fa fa-star" aria-hidden="true"></i>  '+e+"</span>",html:r}),chatDiv=$("#"+activeChat+" > .chat-page > .chat-history"),l=$("#"+activeChat+" > .chat-page > .chatForm > .input-group > .input-group-area > .chatTxt"),r=$("#"+activeChat+" > .chat-page > .chatForm"),s?(d=axPath+"/load-messages-html/"+t+"/"+d,void 0!==i&&(d=d+"/"+i),$.get(d,function(a){addChatHTML(a)})):addChatHTML(n),$.get(axPath+"/adminDetails/"+t+"/"+a,function(a){a.success&&(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=c.replace(/{{ip}}/g,a.ip)).replace(/{{username}}/g,a.name)).replace(/{{email}}/g,a.email)).replace(/{{location}}/g,a.location)).replace(/{{browser}}/g,a.browser)).replace(/{{platform}}/g,a.platform)).replace(/{{ua}}/g,a.ua)).replace(/{{role}}/g,a.role)).replace(/{{access}}/g,a.access)).replace(/{{logo}}/g,a.logo)).replace(/{{chatID}}/g,a.chatID)).replace(/{{tabID}}/g,"tab"+t),$("#userDetails"+t).html(c),$("#userDetails"+t+" .userLoad").hide(),$("#userDetails"+t+" .myprofile").fadeIn(),$("#userDetails"+t+" .table").fadeIn(),$("#userDetails"+t+" .btnDis").prop("disabled",!1),$("#userDetails"+t+" .table").removeClass("hide"),$("#userDetails"+t+" .myprofile").removeClass("hide"))}),$(r).submit(function(a){a.preventDefault();a=$(l).val().trim();""!==a&&($(l).val(""),addMsg(a,-1,adminID,!0,void 0,activeChat))}),$(l).on("keyup",function(a){cannedMsgBol&&1==$("#canned"+t).val()&&cannedMsg(l.val(),t)}),$(chatDiv).click(function(a){hideSmiles(!1,activeChat)}),$(l).click(function(a){hideSmiles(!1,activeChat)}),$(l).focus(function(){$(".input-group").addClass("focused")}).blur(function(){$(".input-group").removeClass("focused")})):(activeChat=h,$("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userDetails"+t).removeClass("hide").addClass("nohide"),$("#tabs > .nav-tabs").find("li.active").removeClass("active"),$("#tabs > .nav-tabs").find("li").find('a[href="#tab'+t+'"]').tab("show")),scrollTab(),$("#chat"+t+" .chat-page").append('<input type="hidden" class="chatAdminID" value="'+a+'" />')}function genChatWindow(a,e,t,s,n,i,o){var c,l,r,d="user"+a,h="chat"+t;flashIt(t,0),-1===(o=parseInt(o))&&(o=adminID),void 0===chatIDs[t]?(c=$("#masterUserDetails").html(),l=$("#masterUserPages").html(),$("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userDetails").append('<div id="userDetails'+t+'" class="nohide">'+c+"</div>"),$("#userPages").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userPages").append('<div id="userPages'+t+'" class="nohide">'+l+"</div>"),chatIDs[t]="",a=(a=(a=$("#masterChatdata").html()).replace(/{{userID}}/g,h)).replace(/{{ownerID}}/g,o),tabs=$("#tabs").bootstrapDynamicTabs(),chats[activeChat=h]={smilesWin:!1,lastMsg:{},tokenID:0,chatID:t,disabledBox:[]},tabs.addTab({id:"tab"+t,title:'<span id="title'+t+'">'+e+"</span>",html:a}),chatDiv=$("#"+activeChat+" > .chat-page > .chat-history"),r=$("#"+activeChat+" > .chat-page > .chatForm > .input-group > .input-group-area > .chatTxt"),a=$("#"+activeChat+" > .chat-page > .chatForm"),s?(d=axPath+"/load-messages-html/"+t+"/"+d,void 0!==i&&(d=d+"/"+i),$.get(d,function(a){addChatHTML(a)})):(n.pagesData=l.replace(/{{tableData}}/g,n.pagesData),addChatHTML(n)),$.get(axPath+"/userDetails/"+t,function(a){a.success?(c=(c=(c=(c=(c=(c=(c=(c=(c=(c=c.replace(/{{ip}}/g,a.ip)).replace(/{{username}}/g,a.name)).replace(/{{email}}/g,a.email)).replace(/{{location}}/g,a.location)).replace(/{{browser}}/g,a.browser)).replace(/{{platform}}/g,a.platform)).replace(/{{ua}}/g,a.ua)).replace(/{{screen}}/g,a.screen)).replace(/{{tabID}}/g,"tab"+t)).replace(/{{chatID}}/g,t),$("#userDetails"+t).html(c),$("#userDetails"+t+" .userLoad").hide(),$("#userDetails"+t+" .table").fadeIn(),$("#userDetails"+t+" .btnDis").prop("disabled",!1),$("#userDetails"+t+" .table").removeClass("hide")):(0===Object.keys(detailsRefresh).length&&(detailsRefreshInt=setInterval(processUserDetails,chatRefreshTime)),detailsRefresh[h]=t)}),$(a).submit(function(a){a.preventDefault();a=$(r).val().trim();""!==a&&($(r).val(""),addMsg(a,-1,adminID,!0,void 0,activeChat))}),$(r).on("keyup",function(a){cannedMsgBol&&1==$("#canned"+t).val()&&cannedMsg(r.val(),t)}),$(chatDiv).click(function(a){hideSmiles(!1,activeChat)}),$(r).click(function(a){hideSmiles(!1,activeChat)}),$(r).focus(function(){$(".input-group").addClass("focused")}).blur(function(){$(".input-group").removeClass("focused")})):(activeChat=h,$("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userDetails"+t).removeClass("hide").addClass("nohide"),$("#userPages").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userPages"+t).removeClass("hide").addClass("nohide"),$("#tabs > .nav-tabs").find("li.active").removeClass("active"),$("#tabs > .nav-tabs").find("li").find('a[href="#tab'+t+'"]').tab("show")),scrollTab()}function scrollTab(){try{$("#tabs > .nav-tabs").find("li.tab_selected").removeClass("tab_selected"),$("#tabs > .nav-tabs").find("li.active").addClass("tab_selected");var a=$(".scroll_tab_inner").scrollLeft(),e=$("#tabs > .nav-tabs").find("li.active").position().left;$(".scroll_tab_inner").scrollLeft(a+e)}catch(a){}}function activateTab(a,e){return void 0!==e&&e.preventDefault(),flashIt(a=a.substr(3),0),activeChat="chat"+a,$("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userDetails"+a).removeClass("hide").addClass("nohide"),$("#userPages").find("div.nohide").removeClass("nohide").addClass("hide"),$("#userPages"+a).removeClass("hide").addClass("nohide"),$("#tabs > .nav-tabs").find("li.active").removeClass("active"),$("#tabs > .nav-tabs").find("li").find('a[href="#tab'+a+'"]').tab("show"),!1}function flashIt(a,e){0===e?$("#title"+a).removeClass("flashit"):$("#title"+a).addClass("flashit")}function closeTab(e,a){var t=e.substr(3),s=$("#chat"+t+" .ownerID").val(),n=1,i=0;$("#chat"+t+" .closed").length&&(n=0),$("#chat"+t+" .chatAdminID").length&&(i=$("#chat"+t+" .chatAdminID").val()),void 0!==a&&(a.preventDefault(),a.stopPropagation()),0===n?s==adminID?closeCall(t,e,n,i):leaveCall(t,e,n):s==adminID?swal({title:sureTxt,text:sureTxt1,icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{a&&closeCall(t,e,n,i)}):swal({title:leaveTxt,text:leaveTxt1,icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{a&&leaveCall(t,e,n)})}function closeCall(e,t,a,s){$.get(axPath+"/close/"+e+"/"+a+"/"+s,function(a){a.success?(tabs.closeById(t),delete chatIDs[e],$("#userDetails"+e).removeClass("nohide").addClass("hide").remove(),$("#userPages"+e).removeClass("nohide").addClass("hide").remove()):swal(oopsTxt,failTxt,"error")})}function leaveCall(e,t,a){$.get(axPath+"/leave/"+e+"/"+a,function(a){a.success?(tabs.closeById(t),delete chatIDs[e],$("#userDetails"+e).removeClass("nohide").addClass("hide").remove(),$("#userPages"+e).removeClass("nohide").addClass("hide").remove()):swal(oopsTxt,failTxt,"error")})}function formatBytes(a,e){if(0==a)return"0 Bytes";var t=e<=0?0:e||2,e=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,e)).toFixed(t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][e]}function refreshAdminAnalytics(){$.get(axPath+"/ping",function(a){})}function genUploadBox(a,e,t,s,n){var i="";return"audio"===s?i="uploadAudio":"video"===s?i="uploadVideo":"image"===s?i="uploadImg":"zip"===s&&(i="uploadZip"),t=formatBytes(t),'<div class="uploadBox '+i+'" id="upload'+a+'">\n    <div class="upInfo">'+fileTxt+" "+e+'</div>\n    <div class="upInfo">'+sizeTxt+" "+t+'</div>\n    <hr>\n    <div class="uploadBoxRes" id="uploadRes'+a+'">\n      <span class="uploading"><span class="icon-upload2"></span> '+n+' <img class="loader" src="'+previewImgLoader+'" /></span>\n    </div>\n    </div>'}String.linkify||(String.prototype.linkify=function(){if(!linkifySys)return linkifySys=!0,this;return this.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,function(a){switch(a.substr(a.lastIndexOf(".")+1)){case"jpg":case"png":case"jpeg":case"gif":case"bmp":var e="pre"+(new Date).getTime().toString()+Math.floor(1e3*Math.random()+1).toString(),t=$("<img />").attr("src",a).on("load error",function(a){"error"!==a.type&&this.complete&&void 0!==this.naturalWidth&&0!=this.naturalWidth?(t.attr("class","previewImg"),t.attr("alt",previewTxt),$("#"+e).html(t)):(t.attr("alt",errLoadTxt),$("#"+e).html('<i style="color: #e74c3c;" class="fa fa-exclamation-triangle"></i>'))});return'<a target="_blank" href="'+a+'"><div> <div id="'+e+'" class="previewBox"><img class="previewImg" src="'+previewImgLoader+'" alt="'+loadingTxt+'"></div> </div> '+a+"</a> ";default:return'<a target="_blank" href="'+a+'">'+a+"</a>"}}).replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a target="_blank" href="http://$2">$2</a>').replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/gim,'<a target="_blank" href="mailto:$&">$&</a>')});var Upload=function(a){this.file=a};Upload.prototype.getType=function(){return this.file.type},Upload.prototype.getSize=function(){return this.file.size},Upload.prototype.getName=function(){return this.file.name},Upload.prototype.doUpload=function(e,a){var t=this,s=new FormData;s.append("file",this.file,this.getName()),s.append("upload_file",!0),$.ajax({type:"POST",url:axPath+"/upload/process/"+e+"/"+a,xhr:function(){var a=$.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",t.progressHandling,!1),a},success:function(a){a.success&&(a.upload?$("#uploadRes"+e).html('<a class="uploadBoxHref" target="_blank" href="'+axPath+"/upload/view/"+e+'"><span class="icon-download2"></span> '+downloadTxt+"</a>"):$("#uploadRes"+e).html('<span class="upFail"> <span class="icon-cross"></span> '+a.error+"</span>"))},error:function(a){$("#uploadRes"+e).html('<span class="upFail"> <span class="icon-cross"></span> '+upFailTxt+"</span>")},async:!0,data:s,cache:!1,contentType:!1,processData:!1,timeout:6e4})},Upload.prototype.progressHandling=function(a){var e=0,t=a.loaded||a.position,s=a.total,n="#progress-wrp";a.lengthComputable&&(e=Math.ceil(t/s*100)),$(n+" .progress-bar").css("width",+e+"%"),$(n+" .status").text(e+"%")},$(document).ready(function(){$.ajaxSetup({timeout:2e4,error:function(a){"timeout"===a.statusText?console.log("Connection Timeout: Please check your internet connection and try again!"):"error"===a.statusText&&console.log("Network Error!")}}),setInterval(refreshAdminAnalytics,refreshAnalyticsTime),timeago.register("en",locale),timeago().render($(".caltime")),chatTabs=$("#chatTabs").scrollTabs(),tabs=$("#tabs").bootstrapDynamicTabs(),tone&&(document.getElementById("myTone").src=tonePath),$(".tab-content").on("click",".send-file-btn",function(){$(".tab-content #"+activeChat+" .send-file").click()}),$(".tab-content").on("change",".send-file",function(a){var e=$(this)[0].files[0],t=new Upload(e),s=!1,n=activeChat.substr(4);chats[activeChat].lastMsg.user==="staff"+adminID&&(s=!0),$.post(axPath+"/upload/new",{name:t.getName(),size:t.getSize(),subMsg:s,chat_id:n},function(a){a.success?(linkifySys=!1,a.upload&&(addMsg(genUploadBox(a.uploadID,t.getName(),t.getSize(),a.type,"Uploading..."),-1,adminID,!1,void 0,activeChat,!1),t.doUpload(a.uploadID,a.uploadAuth,e))):alert(a.error)})}),$.get(axPath+"/chats/load-all",function(t){t.success?(t.updateChatHTML&&Object.keys(t.chatHTML).forEach(function(a){var e=t.chatHTML[a].aUser;("staff"===e.substr(0,5)?genAdminChatWindow:genChatWindow)(t.userList[e].id,t.userList[e].name,t.chatHTML[a].chatID,!1,t.chatHTML[a],void 0,t.chatHTML[a].ownerID),0===t.chatHTML[a].chatStatus&&($("#chat"+t.chatHTML[a].chatID+" .chat-page").append('<input type="hidden" class="closed" value="1" />'),$("#chat"+t.chatHTML[a].chatID+" .chatTxt").prop("disabled",!0),$("#chat"+t.chatHTML[a].chatID+" .input-group-right").addClass("inDisabled"),$("#chat"+t.chatHTML[a].chatID+" .chatTxtIcon").prop("onclick",null).off("click"),$("#chat"+t.chatHTML[a].chatID+" .send-file-btn").removeClass("send-file-btn"))}),t.inviteChatBol&&Object.keys(t.inviteChat).forEach(function(a){(t.inviteChat[a].admin?genAdminChatWindow:genChatWindow)(t.inviteChat[a].userID,t.inviteChat[a].userName,t.inviteChat[a].chatID,!0,null,t.inviteChat[a].type,t.inviteChat[a].ownerID)}),setInterval(refreshData,chatRefreshTime),$("#onlineCount").html("("+t.onlineUsersCount+")"),$("#onlineData").html(t.onlineData),$("#adminCount").html("("+t.onlineAdminCount+")"),$("#adminData").html(t.adminData),$("#inviteData").html(t.inviteData),$('[data-toggle="popover"]').popover(popOverOptions)):swal(oopsTxt,errSomTxt,"info")})});